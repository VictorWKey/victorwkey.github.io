---
// Modal component for displaying project images
---

<div id="project-images-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50">
  <div class="relative w-full h-full max-w-6xl max-h-[95vh] mx-4 flex flex-col">
    
    <!-- Header -->
    <div class="flex items-center justify-between p-4 sm:p-5 bg-white dark:bg-gray-800 rounded-t-xl border-b border-gray-200 dark:border-gray-700">
      <div class="flex items-center gap-3 min-w-0">
        <h3 id="modal-title" class="text-gray-900 dark:text-white font-semibold text-lg truncate"></h3>
        <span id="modal-counter" class="text-gray-500 dark:text-gray-400 text-sm bg-gray-100 dark:bg-gray-700 px-2.5 py-0.5 rounded-md flex-shrink-0"></span>
      </div>
      <button
        onclick="closeProjectModal()"
        class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors"
        aria-label="Close modal"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Content -->
    <div class="flex-1 flex items-center justify-center p-4 relative bg-gray-50 dark:bg-gray-900/50">
      <button
        onclick="prevProjectImage()"
        id="modal-prev-btn"
        class="absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
        aria-label="Previous image"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      
      <div class="flex-1 flex items-center justify-center mx-12 overflow-hidden">
        <div id="image-zoom-container" class="max-w-full max-h-full overflow-auto">
          <img
            id="modal-main-image"
            src=""
            alt=""
            class="max-w-full max-h-full object-contain rounded-lg transition-transform duration-300"
            style="cursor: zoom-in;"
          />
        </div>
      </div>
      
      <button
        onclick="nextProjectImage()"
        id="modal-next-btn"
        class="absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
        aria-label="Next image"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
    </div>

    <!-- Thumbnails -->
    <div class="p-4 bg-white dark:bg-gray-800 rounded-b-xl border-t border-gray-200 dark:border-gray-700">
      <div class="flex justify-center gap-2 max-w-full overflow-x-auto" id="modal-thumbnails"></div>
    </div>
  </div>
</div>

<script is:inline>
  // @ts-nocheck
  // Global variables for modal state
  let currentModalImages = [];
  let currentModalIndex = 0;
  let currentModalTitle = '';

  // Open project images modal
  window.openProjectModal = function(title, images) {
    currentModalImages = images || [];
    currentModalIndex = 0;
    currentModalTitle = title;
    
    if (currentModalImages.length === 0) return;
    
    const modal = document.getElementById('project-images-modal');
    const titleElement = document.getElementById('modal-title');
    const prevBtn = document.getElementById('modal-prev-btn');
    const nextBtn = document.getElementById('modal-next-btn');
    
    // Set title
    if (titleElement) titleElement.textContent = title;
    
    // Show/hide navigation buttons based on image count
    if (currentModalImages.length <= 1) {
      if (prevBtn) prevBtn.style.display = 'none';
      if (nextBtn) nextBtn.style.display = 'none';
    } else {
      if (prevBtn) prevBtn.style.display = 'block';
      if (nextBtn) nextBtn.style.display = 'block';
    }
    
    // Show modal
    if (modal) {
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      document.body.style.overflow = 'hidden';
    }
    
    // Update content
    updateModalContent();
    createThumbnails();
    setupImageZoom();
    
    // Add keyboard listeners
    document.addEventListener('keydown', handleModalKeydown);
  };

  // Close project modal
  window.closeProjectModal = function() {
    const modal = document.getElementById('project-images-modal');
    if (modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
      document.body.style.overflow = 'unset';
    }
    
    // Remove keyboard listeners
    document.removeEventListener('keydown', handleModalKeydown);
  };

  // Navigate to next image
  window.nextProjectImage = function() {
    if (currentModalImages.length > 1) {
      currentModalIndex = (currentModalIndex + 1) % currentModalImages.length;
      resetImageZoom();
      updateModalContent();
      setupImageZoom();
    }
  };

  // Navigate to previous image
  window.prevProjectImage = function() {
    if (currentModalImages.length > 1) {
      currentModalIndex = (currentModalIndex - 1 + currentModalImages.length) % currentModalImages.length;
      resetImageZoom();
      updateModalContent();
      setupImageZoom();
    }
  };

  // Go to specific image
  window.goToProjectImage = function(index) {
    if (index >= 0 && index < currentModalImages.length) {
      currentModalIndex = index;
      resetImageZoom();
      updateModalContent();
      setupImageZoom();
    }
  };

  // Setup image zoom functionality
  function setupImageZoom() {
    const image = document.getElementById('modal-main-image');
    if (!image) return;

    // Double tap to zoom on mobile
    let lastTap = 0;
    image.addEventListener('touchend', function(e) {
      const currentTime = new Date().getTime();
      const tapLength = currentTime - lastTap;
      if (tapLength < 500 && tapLength > 0) {
        e.preventDefault();
        toggleZoom();
      }
      lastTap = currentTime;
    });

    // Click to zoom on desktop
    image.addEventListener('click', function(e) {
      e.preventDefault();
      toggleZoom();
    });
  }

  // Toggle image zoom
  function toggleZoom() {
    const image = document.getElementById('modal-main-image');
    const container = document.getElementById('image-zoom-container');
    if (!image || !container) return;

    const isCurrentlyZoomed = image.style.transform.includes('scale(2)');

    if (isCurrentlyZoomed) {
      // Zoom out
      image.style.transform = 'scale(1)';
      image.style.cursor = 'zoom-in';
      container.style.overflow = 'hidden';
    } else {
      // Zoom in
      image.style.transform = 'scale(2)';
      image.style.cursor = 'zoom-out';
      container.style.overflow = 'auto';
    }
  }

  // Reset image zoom
  function resetImageZoom() {
    const image = document.getElementById('modal-main-image');
    const container = document.getElementById('image-zoom-container');
    if (image) {
      image.style.transform = 'scale(1)';
      image.style.cursor = 'zoom-in';
    }
    if (container) {
      container.style.overflow = 'hidden';
    }
  }

  // Update modal content (image and counter)
  function updateModalContent() {
    const mainImage = document.getElementById('modal-main-image');
    const counterElement = document.getElementById('modal-counter');
    
    if (mainImage && currentModalImages[currentModalIndex]) {
      const currentImage = currentModalImages[currentModalIndex];
      mainImage.src = currentImage.src;
      mainImage.alt = currentImage.alt || `${currentModalTitle} - Image ${currentModalIndex + 1}`;
    }
    
    if (counterElement) {
      counterElement.textContent = `${currentModalIndex + 1} of ${currentModalImages.length}`;
    }
    
    // Update thumbnail selection
    updateThumbnailSelection();
  }

  // Create thumbnail navigation
  function createThumbnails() {
    const thumbnailsContainer = document.getElementById('modal-thumbnails');
    if (!thumbnailsContainer || currentModalImages.length <= 1) return;
    
    thumbnailsContainer.innerHTML = '';
    
    currentModalImages.forEach((image, index) => {
      const thumbnailBtn = document.createElement('button');
      thumbnailBtn.className = `flex-shrink-0 w-16 h-12 sm:w-20 sm:h-16 rounded-lg overflow-hidden border-2 transition-all duration-200 ${
        index === currentModalIndex
          ? 'border-primary ring-2 ring-primary/50 scale-105'
          : 'border-gray-600 hover:border-gray-400 hover:scale-105'
      }`;
      thumbnailBtn.onclick = () => goToProjectImage(index);
      
      const thumbnailImg = document.createElement('img');
      thumbnailImg.src = image.src;
      thumbnailImg.alt = `Thumbnail ${index + 1}`;
      thumbnailImg.className = 'w-full h-full object-cover';
      
      thumbnailBtn.appendChild(thumbnailImg);
      thumbnailsContainer.appendChild(thumbnailBtn);
    });
  }

  // Update thumbnail selection
  function updateThumbnailSelection() {
    const thumbnails = document.querySelectorAll('#modal-thumbnails button');
    thumbnails.forEach((btn, index) => {
      if (index === currentModalIndex) {
        btn.className = btn.className.replace('border-gray-600 hover:border-gray-400', 'border-primary ring-2 ring-primary/50 scale-105');
      } else {
        btn.className = btn.className.replace('border-primary ring-2 ring-primary/50 scale-105', 'border-gray-600 hover:border-gray-400');
      }
    });
  }

  // Handle keyboard navigation
  function handleModalKeydown(e) {
    const modal = document.getElementById('project-images-modal');
    if (!modal || modal.classList.contains('hidden')) return;
    
    switch(e.key) {
      case 'Escape':
        closeProjectModal();
        break;
      case 'ArrowLeft':
        prevProjectImage();
        break;
      case 'ArrowRight':
        nextProjectImage();
        break;
    }
  }

  // Close modal when clicking backdrop
  document.addEventListener('click', (e) => {
    const modal = document.getElementById('project-images-modal');
    if (e.target === modal) {
      closeProjectModal();
    }
  });
</script>